.. _mcp-server-label:

=========================================================
MCP сервер для сервиса Torrow
=========================================================

    .. |галка| image:: media/galka.png
        :width: 21
        :alt: alternative text

MCP (Model Context Protocol) сервер для сервиса Torrow позволяет интеллектуальным ассистентам (например, в Cursor или Claude Desktop) управлять вашими заметками и каталогами в Torrow, а также искать информацию в документации сервиса.

Зачем это нужно?
----------------------------

Используя MCP сервер, вы можете через AI-ассистента:

* **Управлять заметками** — создавать, редактировать и искать заметки, просто общаясь с ассистентом
* **Организовывать информацию** — структурировать знания в каталогах с помощью тегов
* **Быстро находить информацию** — искать как в ваших заметках, так и в документации Torrow
* **Автоматизировать работу** — делегировать рутинные задачи по управлению заметками AI-ассистенту

Возможности MCP сервера
----------------------------

Управление заметками (Notes)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* **Создание заметки** — создает новую заметку в указанном каталоге с названием, текстом и тегами
* **Изменение заметки** — обновляет существующую заметку (название, текст, теги)
* **Удаление заметки** — удаляет заметку по её идентификатору
* **Поиск заметок** — ищет заметки в каталоге по текстовой фразе, тегам и другим параметрам
* **Получение информации о заметке** — выводит полные данные заметки по идентификатору
* **Получение списка заметок** — получает несколько заметок по их идентификаторам

Управление каталогами (Archives)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* **Создание каталога** — создает новый каталог для организации заметок (максимум 10 каталогов)
* **Изменение каталога** — обновляет название, описание и теги каталога
* **Удаление каталога** — удаляет каталог с опциональным удалением всех заметок в нём
* **Получение информации о каталоге** — выводит данные каталога и список заметок в нём
* **Список каталогов** — получает список всех доступных каталогов

Работа с документацией Torrow
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* **Поиск в документации** — ищет информацию в документации Torrow по запросу
* **Получение статьи** — получает полный текст статьи из документации в различных форматах

Примеры использования
----------------------------

После подключения MCP сервера к AI ассистенту (смотри настройку ниже) вы сможете делать запросы к информации в сервисе Torrow.

Создание заметки
~~~~~~~~~~~~~~~~~~

Попросите AI-ассистента:

"Создай заметку 'Рецепт борща' с текстом 'Варить 2 часа' и тегами 'Рецепты' и 'Еда' в каталоге Рецепты"

Поиск заметок
~~~~~~~~~~~~~~

"Найди все заметки с рецептами блинов в каталоге Рецепты"

"Найди заметки по запросу 'борщ' в каталоге Рецепты"

Создание каталога
~~~~~~~~~~~~~~~~~~

"Создай каталог 'Кулинарные рецепты' с описанием 'Мои любимые рецепты' и тегами 'Кулинария'"

Поиск в документации
~~~~~~~~~~~~~~~~~~~~~~

"Найди информацию о настройке WebHook в документации Torrow"

"Покажи статью о настройке интеграций MCP сервера"


Подключение AI ассистента к MCP серверу
----------------------------

MCP сервер работает как HTTP сервис. Для его подключения к AI ассистенту вам понадобится:

* URL адрес HTTP сервера MCP: ``https://mcp.torrow.net/mcp``
* Токен доступа к Torrow API: нужно получить в настройках вашего аккаунта Torrow, раздел "**Профиль**" пункт "**Настройки**" \ "**Интеграции**".
* AI ассистент (например, среда Cursor, Claude Desktop или другая, поддерживающая подключение MCP сервера)

Подключение к Cursor
~~~~~~~~~~~~~~~~~~~~~~

Через меню настроек (рекомендуется)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Откройте Cursor и перейдите в настройки:

   * Нажмите ``Ctrl+,`` (Windows/Linux) или ``Cmd+,`` (macOS)
   * Или выберите **File** → **Preferences** → **Settings**

2. В поиске настроек введите "MCP" или "Model Context Protocol"

3. Найдите раздел **MCP Servers** или **Model Context Protocol**

4. Нажмите кнопку **Add Server** или **+** для добавления нового сервера

5. Заполните форму добавления сервера:

   * **Server Name**: ``torrow-mcp-service``

   * **Server Type**: выберите **HTTP** или **URL**

   * **URL**: ``https://mcp.torrow.net/mcp``

   * **Headers**: добавьте заголовок:

     * **Key**: ``TORROW-TOKEN``

     * **Value**: ваш токен доступа к Torrow API

1. Сохраните настройки и перезапустите Cursor

2. После перезапуска проверьте, что сервер подключен — в Cursor должны появиться доступные инструменты (tools), ресурсы (resources) и промпты (prompts) от сервера Torrow.

Через редактирование конфигурационного файла
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Альтернативный способ — редактирование файла конфигурации напрямую:

1. Откройте файл конфигурации MCP в Cursor:

   * **Windows**: ``%AppData%\Cursor\User\globalStorage\mcp.json``
   * **macOS**: ``~/Library/Application Support/Cursor/User/globalStorage/mcp.json``
   * **Linux**: ``~/.config/Cursor/User/globalStorage/mcp.json``

2. Добавьте конфигурацию сервера (замените URL на адрес вашего HTTP сервера):

.. code-block:: json

    {
      "mcpServers": {
        "torrow-mcp-service": {
          "url": "https://mcp.torrow.net/mcp",
          "headers": {
            "TORROW-TOKEN": "your_torrow_token_here"
          }
        }
      }
    }

.. note::
    В HTTP режиме токен передается клиентом в заголовке ``TORROW-TOKEN`` при каждом запросе.

1. Сохраните файл и перезапустите Cursor.

2. После перезапуска проверьте, что сервер подключен — в Cursor должны появиться доступные инструменты (tools), ресурсы (resources) и промпты (prompts) от сервера Torrow.

Подключение к Claude Desktop
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Через меню настроек (рекомендуется)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Откройте Claude Desktop

2. Перейдите в настройки:

   * Нажмите на иконку настроек в правом верхнем углу
   * Или выберите **Settings** из меню приложения

3. Найдите раздел **MCP Servers** или **Model Context Protocol**

4. Нажмите кнопку **Add Server** или **+** для добавления нового сервера

5. Заполните форму добавления сервера:

   * **Server Name**: ``torrow-mcp-service``
   * **Server Type**: выберите **HTTP** или **URL**
   * **URL**: ``https://mcp.torrow.net/mcp``
   * **Headers**: добавьте заголовок:
     * **Key**: ``TORROW-TOKEN``
     * **Value**: ваш токен доступа к Torrow API

6. Сохраните настройки и перезапустите Claude Desktop

7. После перезапуска проверьте, что сервер подключен — в Claude Desktop должны появиться доступные инструменты (tools), ресурсы (resources) и промпты (prompts) от сервера Torrow.

Через редактирование конфигурационного файла
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Альтернативный способ — редактирование файла конфигурации напрямую:

1. Откройте файл конфигурации Claude Desktop:

   * **Windows**: ``%AppData%\Claude\claude_desktop_config.json``
   * **macOS/Linux**: ``~/Library/Application Support/Claude/claude_desktop_config.json``

2. Если файл не существует, создайте его.

3. Добавьте конфигурацию сервера (замените URL на адрес вашего HTTP сервера):

.. code-block:: json

    {
      "mcpServers": {
        "torrow-mcp-service": {
          "url": "https://mcp.torrow.net/mcp",
          "headers": {
            "TORROW-TOKEN": "your_torrow_token_here"
          }
        }
      }
    }

.. note::
    В HTTP режиме токен передается клиентом в заголовке ``TORROW-TOKEN`` при каждом запросе.

1. Сохраните файл и перезапустите Claude Desktop.

Проверка подключения
----------------------------

После настройки и перезапуска клиента проверьте:

1. **Доступность инструментов** — в клиенте должны быть доступны инструменты для работы с заметками и каталогами
2. **Доступность ресурсов** — должны быть доступны ресурсы для получения информации о заметках и каталогах
3. **Доступность промптов** — должны быть доступны промпты для поиска и работы с каталогами

Вы можете проверить подключение, попросив AI-ассистента:

* "Покажи список моих каталогов"
* "Создай заметку в каталоге X"
* "Найди заметки Y"

Отладка
----------------------------

Если сервер не подключается:

1. **Проверьте URL сервера** — убедитесь, что адрес HTTP сервера указан правильно
2. **Проверьте токен** — убедитесь, что токен указан правильно в конфигурации
3. **Проверьте доступность сервера** — убедитесь, что HTTP сервер доступен по указанному адресу
4. **Проверьте логи клиента** — посмотрите логи на наличие ошибок подключения

Формат данных
----------------------------

Заметки и каталоги
~~~~~~~~~~~~~~~~~~~

Заметки и каталоги в Torrow имеют следующую структуру:

* **Название** — название заметки или каталога (строка)
* **Текст** — содержимое заметки или описание каталога (HTML-форматированный текст, поддерживаются теги ``<img>`` и ``<a>``)
* **Теги** — массив тегов для группировки и поиска. Тег может быть:
  * Простой строкой длиной 3-100 символов (допустимые символы: A-z, А-я, 0-9, /, \, -, _, .)
  * Двумя строками, разделёнными двоеточием: ``<tag_value>:<tag_group>``

Идентификаторы
~~~~~~~~~~~~~~~

Все идентификаторы (noteId, archiveId) в Torrow представляют собой строки из шестнадцатеричных цифр, например: ``aae6203eb4d3340ec24061bd89b597121``

Ограничения
----------------------------

* Максимальное количество каталогов: 10
* Максимальная длина названия: 100 символов
* При создании каталога/заметки проверяется уникальность названия
* Операции изменения/удаления работают только с существующими объектами

Дополнительная информация
----------------------------

* Исходный код MCP сервера: https://github.com/torrowtechnologies/torrow-mcp
* Документация по Model Context Protocol: https://modelcontextprotocol.io
* Если у вас возникли вопросы, обратитесь в `техническую поддержку Torrow`_

.. _`техническую поддержку Torrow`: https://t.me/TorrowSupport

.. raw:: html

   <torrow-widget
      id="torrow-widget"
      url="https://web.torrow.net/app/tabs/tab-search/service;id=103edf7f8c4affcce3a659502c23a?closeButtonHidden=true&tabBarHidden=true"
      modal="right"
      modal-active="false"
      show-widget-button="true"
      button-text="Заявка эксперту"
      modal-width="550px"
      button-style = "rectangle"
      button-size = "60"
      button-y = "top"
   ></torrow-widget>
   <script src="https://cdn-public.torrow.net/widget/torrow-widget.min.js" defer></script>

.. raw:: html

   <!-- <script src="https://code.jivo.ru/widget/m8kFjF91Tn" async></script> -->
